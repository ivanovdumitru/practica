var Table,indexOf=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Table=function(){function t(t){var e,i,n,l;this.request=null,this.existMore=!0,this.order="",this.filter={},this.actionsDiv=$("<div />"),this.menuDiv=$("<ul />"),this.table=$('<div class="table" />'),this.head=$('<div class="head" />'),this.body=$('<div class="body" />'),this.foot=$('<div class="foot" />'),this.onOrder=null,this.onFilter=null,this.onGetData=null,this.onRowSelect=null,this.onCloseRowContainer=null,this.current=null,swig.setFilter("hasValue",function(t){return"undefined"!=typeof t.value}),this.templates={actions:swig.compile('{% for action in actions %}{% if not action.element %}<button type="button" class="btn {{action.class}}" data-action="{{action.id}}">{{action.label}}</button>{% endif%}{% endfor %}'),menu:swig.compile('{% for action in actions %}<li data-action="{{action.id}}">{{action.label}}</li>{% endfor %}'),columns:swig.compile('<table><thead><tr>{% for i in Array.prototype.constructor.call(null, rows.columns) %}<th class="col-{{loop.index0}}"></th>{% endfor %}</tr></thead><tbody>{% for row in rows %}<tr>{% for column in row %}<td{% if column.attrs and column.attrs.class %} class="{{column.attrs.class}}"{% endif %}{% for attr, value in column.attrs %}{% if attr != "width" and attr != "class" %} {{attr}}="{{value}}"{% endif %}{% endfor %}>{% if column.label %}<label{% if column.name and column.order %} data-order="{{column.name}}" class="order{% if order and order.field == column.name %} {{order.sort}}{% endif %}"{% endif %}{% if column.label.key %} data-i18n="{{column.label.key}}">{{column.label.text}}{% else %}>{{column.label}}{% endif %}</label>{% endif %} {% if column.filter == "select" %}<select name="{{column.name}}">{% for option in column.filterData %}<option value="{{option.value}}"{% if column.filterValue and column.filterValue == option.value %} selected="selected"{% endif %}{% if option.label.key %} data-i18n="{{option.label.key}}">{{option.label.text}}{% else %}>{{option.label}}{% endif %}</option>{% endfor %}</select>{% elif column.filter == "date" or column.filter == "datetime" or column.filter == "time" %}{% if column.filter != "time" %}<div class="date-picker"><input autocomplete="off" type="text" name="{{column.name}}{% if column.filter == "datetime" %}[date]{% endif %}" value="{{column.filterValue}}"/></div>{% endif %}{% if column.filter != "date" %}<div class="time-picker"><input autocomplete="off" type="text" name="{{column.name}}{% if column.filter == "datetime" %}[time]{% endif %}" value="{{column.filterValue}}"/></div>{% endif %}{% elif column.filter == "text" %}<input autocomplete="off" type="text" name="{{column.name}}" value="{{column.filterValue}}"/>{% elif column.filter == "number" or column.filter == "comparison" %}<input autocomplete="off" type="text" name="{{column.name}}" class="number{% if column.filter == "comparison" %} comparison{% if column.extendedFilter %} extended{% endif %}{% endif %}" value="{{column.filterValue}}"/>{% elif column.filter %}<input autocomplete="off" type="{{column.filter}}" name="{{column.name}}" value="{{column.filterValue}}"/>{% endif %}</td>{% endfor %}</tr>{% endfor %}</tbody></table>'),rows:swig.compile('{% if rows.head %}<table><thead><tr>{% for i in Array.prototype.constructor.call(null, rows.columns) %}<th class="col-{{loop.index0}}"></th>{% endfor %}</tr></thead><tbody>{% endif %}{% for row in rows %}<tr{% if row.attrs %}{% for attr, value in row.attrs %} {{attr}}="{{value}}"{% endfor %}{% endif %}>{% for cell in row.cells %}<td{% if cell.attrs %}{% for attr, value in cell.attrs %} {{attr}}="{{value}}"{% endfor %}{% endif %}{% if cell|hasValue %}{% if not cell.safe %} title="{{cell.value}}"{% endif %}>{% if cell.safe %}{{cell.value|safe}}{% else %}{{cell.value}}{% endif %}{% else %} title="{{cell}}">{{cell}}{% endif %}</td>{% endfor %}</tr>{% endfor %}{% if rows.head %}</tbody></table>{% endif %}'),foot:swig.compile('<table><thead><tr>{% for i in Array.prototype.constructor.call(null, rows.columns) %}<th class="col-{{loop.index0}}"></th>{% endfor %}</tr></thead><tbody>{% for row in rows %}<tr{% if row.attrs %}{% for attr, value in row.attrs %} {{attr}}="{{value}}"{% endfor %}{% endif %}>{% for cell in row.cells %}<td{% if cell.attrs %}{% for attr, value in cell.attrs %} {{attr}}="{{value}}"{% endfor %}{% endif %}{% if cell|hasValue %}{% if not cell.safe %} title="{{cell.value}}"{% endif %}>{% if cell.safe %}{{cell.value|safe}}{% else %}{{cell.value}}{% endif %}{% else %} title="{{cell}}">{{cell}}{% endif %}</td>{% endfor %}</tr>{% endfor %}</tbody><tfoot><tr><th colspan="{{rows.columns}}"><div class="spinner"><div></div><div></div><div></div><div></div></div></th></tr></tfoot></table>')},n=this.constructor["default"];for(i in n)l=n[i],this[i]=l;for(e in t)e in this&&(this[e]=t[e]);this.tableBinds()}return t.VERSION="1.2.0",t["default"]={start:0,length:100,loadMoreLength:50,fromBottomNextPage:50,attrs:{},actions:[],columns:[],footer:[],rows:[],url:"",datePickerOptions:{dateFormat:"dd/mm/yy",constrainInput:!0},timePickerOptions:{timeFormat:"HH:mm"},showDefaultOrder:!1,editedNotification:!0,contextMenu:!0,selectable:!0,selectFirst:!1,defaultAction:null,scrollAlign:"right",arrowNavigation:!1,height:null,heightOfParent:null,MSSQLPagination:!1,filterTimeOut:300,autoRefresh:!0,margin:null},t.prototype.getData=function(){var t,e,i,n,l;if(n=this,t={start:this.start,length:n.start?n.loadMoreLength:n.length},this.order&&(t.ordering=this.order),this.filter){i=this.filter;for(e in i)l=i[e],t[e]=l}n.start&&null!=this.MSSQLData&&(t.lastRow=this.MSSQLData),this.existMore&&(this.table.addClass("loading"),this.request=$.getJSON(this.url,t,function(t){return n.table.removeClass("loading"),n.request=null,n.MSSQLPagination&&(n.MSSQLData=t[t.length-1]),null!=n.onGetData&&(t=n.onGetData(t,n)),n.renderRows(t,!!n.start),!t.length||t.length<(n.start?n.loadMoreLength:n.length)?n.existMore=!1:n.start+=t.length}).always(function(){n.table.removeClass("loading"),n.request=null}))},t.prototype.nextPage=function(){null==this.request&&this.getData()},t.prototype.resetTable=function(){null!=this.request&&this.request.abort(),this.request=null,this.start=0,this.existMore=!0,this.body.html(""),this.getData(),this.updateActions()},t.prototype.columnsBinds=function(){this.orderBind(),this.filterBind()},t.prototype.filterBind=function(){var t,e,i,n;i=this,e=null,null!=$.fn.datepicker&&(t=$.extend({},this.datePickerOptions),t.showOn="button",null!=t.constrainInput&&t.constrainInput&&(t.constrainInput=!1),this.head.find(".date-picker input").datepicker(t),this.head.find(".date-picker .ui-datepicker-trigger").attr("tabIndex",-1),null!=this.datePickerOptions.constrainInput&&this.datePickerOptions.constrainInput&&(this.head.find(".date-picker input").on("keydown.table blur",function(e){var i,n,l,a,o,s,r,d,u,c,h,f,p,m;if(13===(h=e.keyCode)||9===h||"blur"===e.type){if(c=new Date,a={d:"",m:"",y:""},o=t.dateFormat.replace(/[^\w]/g,"").replace(/y/g,"yy"),m=$(this).val(),m.match(/^(\+|-)\d+$/g))c.setDate(c.getDate()+parseInt(m));else if(m.match(/^\d+$/)){for(s=r=0,u=o.length;u>r;s=++r)i=o[s],s<m.length&&(a[i]+=m[s]);if(4!==a.y.length){for(p="",s=d=0,f=4-a.y.length;f>=0?f>d:d>f;s=f>=0?++d:--d)p+=c.getFullYear().toString()[s];a.y=p+a.y}}else{if(!m.match(/^((\+|-)(\d+)(d|m|y)){1,3}$/gi))return void $(this).trigger("change");for(;m.match(/((\+|-)(\d+)(d|m|y))/i);)n=m.match(/((\+|-)(\d+)(d|m|y))/i)[0],m=m.replace(n,""),l=parseInt(n.slice(0,-1)),"d"===n.toLowerCase().slice(-1)&&c.setDate(c.getDate()+l),"m"===n.toLowerCase().slice(-1)&&c.setMonth(c.getMonth()+l),"y"===n.toLowerCase().slice(-1)&&c.setFullYear(c.getFullYear()+l)}a.d&&c.setDate(parseInt(a.d)),a.m&&c.setMonth(parseInt(a.m)-1),a.y&&c.setFullYear(parseInt(a.y)),$(this).datepicker("setDate",c),$(this).trigger("change")}}),this.head.find(".date-picker input").each(function(){var t,e;t=$(this).data("events")||$._data($(this)[0],"events"),e=t.keydown,e.unshift(e.pop())})),this.head.find(".date-picker input").on("change keyup.table",function(t){var n;n=$(this).val(),("keyup"!==t.type||null!=t.keyCode&&13===t.keyCode||!n.length||n.length===i.datePickerOptions.dateFormat.replace(/y/g,"yy").length)&&(null!=i.datePickerOptions.datePickerToFormat?(e=i.datePickerOptions.datePickerToFormat(n),"Invalid Date"===e||null==e?e=null:("keyup"!==t.type||t.ctrlKey||17===t.keyCode||$(this).datepicker("setDate",e),e=e.toISOString())):e=n,i.doFilter(this,e))})),null!=$.fn.timepicker&&(n=$.extend({},this.timePickerOptions),n.showOn="button",this.head.find(".time-picker input").timepicker(n),this.head.find(".time-picker .ui-datepicker-trigger").attr("tabIndex",-1),null!=n.showSecond&&n.showSecond&&this.head.find(".time-picker").addClass("seconds"),this.head.find(".time-picker input").on("change keyup.table",function(t){var n;n=$(this).val(),("keyup"!==t.type||null!=t.keyCode&&13===t.keyCode||!n.length||n.length===i.timePickerOptions.timeFormat.length)&&(e=null!=i.timePickerOptions.timePickerToFormat?i.datePickerOptions.datePickerToFormat(n):n,i.doFilter(this,e,!1))})),this.head.find("input").on("focus.table",function(){$(this).select()}),this.head.find("input").on("keypress.table",function(t){var e,i,n;if(t.charCode&&$(this).hasClass("number")&&(e=t.which||t.keyCode,48>e||e>57)){if(n=$(this).val(),$(this).hasClass("comparison")&&(!n.match(/\./)&&46===e||(!n.match(/[=><]/)||$(this).hasClass("extended")&&n.match(/([=><]+)/g)&&("<="===(i=n.match(/([=><]+)/g)[0]+String.fromCharCode(e))||"<>"===i||">="===i))&&(62===e||61===e||60===e)))return;return!1}}),this.head.find("input").on("keyup.table",function(){$(this).parent().hasClass("date-picker")||$(this).parent().hasClass("time-picker")||(e=$(this).val(),i.doFilter(this,e,!1))}),this.head.find("select").on("change",function(){i.doFilter(this,$(this).val())}),this.head.find("input:checkbox").on("change",function(){i.doFilter(this,$(this).prop("checked"))})},t.prototype.doFilter=function(t,e,i){var n,l,a;null==i&&(i=!0),l=$.extend(!0,{},this.filter),n=$(t).attr("name"),a=this,null==this.timeoutBind&&(this.timeoutBind=null),null!=this.onFilter?this.onFilter(t,e):(null==e||e||(e=null),null!=e?this.filter[n]=e:delete this.filter[n],l[n]!==this.filter[n]&&this.autoRefresh&&(clearTimeout(this.timeoutBind),i?a.resetTable():this.timeoutBind=setTimeout(function(){a.resetTable()},a.filterTimeOut)))},t.prototype.orderBind=function(){var t;t=this,this.head.find("label.order").on("click.table",function(){var e,i,n;return t.request?!1:(e=t.order,i=$(this).data("order"),n=t.order.indexOf(i),t.head.find("label.order").removeClass("asc desc"),-1!==n?n?(t.order=i,$(this).addClass("asc")):(t.order="-"+i,$(this).addClass("desc")):(t.order=i,$(this).addClass("asc")),null!=t.onOrder?t.onOrder(t.order):e!==t.order&&t.resetTable(),!1)})},t.prototype.tableBinds=function(){var t,e,i,n,l,a,o;if(o=this,this.bindActions(),this.contextMenu&&this.body.on("contextmenu.table","tr:not(.row-content)",function(t){return o.menu(this,t),!1}),this.selectable&&this.body.on("mousedown.table","tr:not(.row-content)",function(){return null!=o.request?!1:void(o.rowSelect($(this).index()-$(this).prevAll(".row-content").length,this)&&($(o.body).find("tr").removeClass("active"),$(this).addClass("active")))}),this.defaultAction&&this.actions)for(a=this.actions,n=0,l=a.length;l>n;n++)t=a[n],t.id===this.defaultAction&&(i=t,e=this.actionsDiv,this.body.on("dblclick.table","tr:not(.row-content)",function(){return null!=o.request?!1:(document.getSelection().removeAllRanges(),void(e.find("[data-action="+i.id+"]").length?e.find("[data-action="+i.id+"]").trigger("click.table"):i.callback(o.rows[o.current],o)))}));this.body.on("scroll.table",function(){var t,e,i,n,l,a;o.body.find("tr.row-content").find("form").length&&(a={top:o.body.position().top,bottom:o.body.position().top+o.body.height()},o.body.find("tr.row-content").find("form").find(".error").each(function(){var t,e;e=$(this).position().top,t=$(this).find(".error-text"),e>a.top&&e+t.height()<a.bottom?t.css("top",e):t.css("top",-9999)})),e=o.body.position(),t=o.body.height(),o.body.find("tbody tr").length&&(l=o.body.find("tbody tr:last").position(),n=o.body.find("tbody tr:last").outerHeight(),i=l.top+n-(t+e.top),i<o.fromBottomNextPage&&i>=0&&o.nextPage())}),$("body").off("keydown.table"),$("body").on("keydown.table",function(t){var e,i,n,l,a,o,s,r;38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode||$(t.target).is("input, textarea, select")||(r=$(".table-data.arrow-navigation:visible"),r.find(".body tr.active").length&&(r=r.find(".body tr.active").closest(".table-data"),r=r.filter(".active").length?r.filter(".active"):r.first(),a=$(".body",r),s=$("tr.active",r),s.length&&(13===t.keyCode?s.trigger("dblclick.table"):(o=38===t.keyCode?s.prevAll().not(".row-content"):s.nextAll().not(".row-content"),o=o.first(),o.length&&(o.trigger("mousedown.table"),i=a.height(),e=o.height(),l=a.scrollTop(),n=o.offset().top-a.offset().top,0>n?a.scrollTop(l+n):n+e>i&&a.scrollTop(n-i+l+e))))))})},t.prototype.menu=function(t,e){var i,n,l,a,o,s,r,d,u;if(this.contextMenu){for(this.menuDiv.html(this.templates.menu({actions:this.actions})),d=this,s=this.actions,n=0,a=s.length;a>n;n++)i=s[n],this.menuDiv.attr({id:"contextmenu"}).find("[data-action="+i.id+"]").data("action-data",i).on("mousedown.table",function(){i=$(this).data("action-data"),null!=i.callback&&i.callback(d.rows[d.current],d)}),o=this.menuDiv.find("[data-action="+i.id+"]"),null==i.global&&!i.global&&null!=$(t).data("action-disabled")&&(r=i.id,indexOf.call($(t).data("action-disabled"),r)>=0)?o.addClass("disabled"):o.removeClass("disabled");$(document.body).append(this.menuDiv),u=e.clientY,l=e.clientX,u+this.menuDiv.height()+5>$(document).height()&&(u-=this.menuDiv.height()),l+this.menuDiv.width()+5>$(document).width()&&(l-=this.menuDiv.width()),this.menuDiv.css({top:u,left:l}),$(document).on("mousedown.table",function(){return $("#contextmenu").remove(),$(document).unbind("mousedown.table")})}},t.prototype.rowSelect=function(t,e){return this.current=t,this.updateActions(e),null!=this.onRowSelect?this.onRowSelect(this.rows[t],e):!0},t.prototype.addRowContainer=function(t,e){var i,n,l;if(null==e&&(e=!1),n=$("<tr />"),i=$('<td colspan="'+this.cols+'" />'),i.html(t),n.addClass("row-content").html(i),e){if(this.body.find("tr.active").next().hasClass("row-content"))return;n.addClass("pinned"),n.insertAfter(this.body.find("tr.active")),this.updateActions(this.body.find("tr.active"))}else this.body.find("tbody").length||(l=[],l.columns=this.cols,l.head=!0,this.body.html(this.templates.rows({rows:l}))),this.body.find("tbody").prepend(n);return this.scrollRowContainer(n),n},t.prototype.scrollRowContainer=function(t){var e;this.rowResize(),e=this.body.position(),t.hasClass("pinned")&&(e.top+=this.body.find("tr.active").height()),this.body.scrollTop(this.body.scrollTop()+(t.position().top-e.top))},t.prototype.closeRowContainer=function(t,e){var i,n,l,a,o;if(null==e&&(e=!1),o=this,a=this.body.find("tbody tr"),this.editedNotification||(e=!0),a.length>t){if(l=a.eq(t),n=function(){var t;t=l.prev(".active"),l.remove(),t.length&&o.updateActions(t),o.body.find("tbody tr").length||o.body.html(""),o.rowResize()},null!=this.onCloseRowContainer){if(i=this.onCloseRowContainer(t,e,this,l,n),null!=i&&!i)return!1}else if(!e&&l.is(".edited")&&!confirm("You are sure?\n Added/edited data not was saved"))return!1;n()}return!0},t.prototype.lockAction=function(t,e,i){var n,l,a,o,s;for(null==e&&(e=null),null==i&&(i=!1),s=this.actions,a=0,o=s.length;o>a;a++)if(n=s[a],n.id===t)return l=null!=n.element?$(n.element):this.actionsDiv.find("[data-action="+n.id+"]"),l.hasClass("locked")&&(null==e||null!=e&&!e)?l.removeClass("locked"):l.addClass("locked"),void(i?l.addClass("disabled"):l.removeClass("disabled"))},t.prototype.updateActions=function(t){var e,i,n,l,a,o,s,r,d,u;for(null==t&&(t=null),null!=t?(l=null!=$(t).data("action-disabled")?$(t).data("action-disabled"):null,n=null!=$(t).data("action-content-disabled")&&$(t).next(".row-content").length?$(t).data("action-content-disabled"):null):l=n=null,r=this.actions,a=0,o=r.length;o>a;a++)e=r[a],i=null!=e.element?$(e.element):this.actionsDiv.find("[data-action="+e.id+"]"),s=this.menuDiv.find("[data-action="+e.id+"]"),null!=this.request||null==e.global&&!e.global&&(null==t||null!=t&&(null!=l&&(d=e.id,indexOf.call(l,d)>=0)||null!=n&&(u=e.id,indexOf.call(n,u)>=0)))?(i.addClass("disabled"),s.addClass("disabled")):(i.removeClass("disabled"),s.removeClass("disabled"))},t.prototype.renderActions=function(){var t,e,i,n,l;for(this.actionsDiv.addClass("table-actions"),n=[],l=this.actions,e=0,i=l.length;i>e;e++)t=l[e],null==t.element&&n.push(t);return this.actionsDiv.html(this.templates.actions({actions:n})),this.bindActions(),this.updateActions(),this.actionsDiv},t.prototype.bindActions=function(){var t,e,i,n,l,a;for(a=this,l=this.actions,i=0,n=l.length;n>i;i++)t=l[i],e=null!=t.element?$(t.element):this.actionsDiv.find("[data-action="+t.id+"]"),e.data("action-data",t).off("click.table"),e.data("action-data",t).on("click.table",function(){$(this).hasClass("disabled")||$(this).hasClass("locked")||(t=$(this).data("action-data"),null!=t.callback&&t.callback(a.rows[a.current],a))})},t.prototype.renderRows=function(t,e){var i,n,l,a;for(null==e&&(e=!1),e||(this.rows=[],this.body.scrollTop(0),this.updateActions()),i=[],n=0,l=t.length;l>n;n++)a=t[n],Array.isArray(a)?i.push({attrs:null,cells:a}):i.push(a);return Array.prototype.push.apply(this.rows,i),i.columns=this.cols,this.rows.length?i.length&&(e?this.body.find("tbody").append(this.templates.rows({rows:i})):(i.head=!0,this.body.html(this.templates.rows({rows:i})))):this.body.html(""),this.table.is(":visible")&&this.rowResize(),!e&&this.selectable&&this.selectFirst&&this.rows.length&&this.body.find("tbody tr:first").trigger("mousedown.table"),this.body},t.prototype.columnRule=function(t,e){var i,n,l,a,o,s,r,d,u,c,h,f,p;if(null==e&&(e=null),d="#"+this.table.attr("id")+" table > thead > tr > .col-"+t,$("#table_columns").length||$("head").append($("<style />").attr({id:"table_columns",type:"text/css"})),document.styleSheets)for(f=document.styleSheets,a=0,s=f.length;s>a&&(h=f[a],"table_columns"!==$(h.ownerNode).attr("id"));a++);for(n=h.cssRules?h.cssRules:h.rules,l=!1,u=o=0,r=n.length;r>o;u=++o)if(c=n[u],null!=c.selectorText&&c.selectorText.toLowerCase()===d){l=!0;break}if(null==e)return void(l&&(h.cssRules?h.deleteRule(u):h.removeRule(u)));if(l||(u=n.length,l=!0,h.addRule?h.addRule(d,null,u):h.insertRule(d+" {}",u)),l)for(i in e)p=e[i],n[u].style[i]=p},t.prototype.columnsResize=function(){var t,e,i,n,l,a,o,s,r,d,u,c,h,f,p,m,b,g,y,v,w,k,$,x,C,D,S,O,T;if(S=this,a=0,l=[],D=[],this.cols=0,this.columns.length)for(D=Array.isArray(this.columns[0])?this.columns:[this.columns],w=D[0],s=0,u=w.length;u>s;s++)i=w[s],this.cols+=null!=i.attrs&&null!=i.attrs.colspan?i.attrs.colspan:1;for(D.columns=this.cols,o=r=0,k=this.cols-1;k>=0?k>=r:r>=k;o=k>=0?++r:--r)S.columnRule(o);for(this.table.css({width:""}),this.head.css({display:"inline-block",width:"auto"}).find("table").css({width:"auto"}),this.body.hide(),this.foot.hide(),O=this.table.width(),this.head.css({display:"",width:""}).find("table").css({width:""}),this.body.show(),this.foot.show(),this.table.width(O),$=["fixed","percent","auto"],d=0,c=$.length;c>d;d++)for(t=$[d],m=0,h=D.length;h>m;m++)for(C=D[m],o=-1,g=0,f=C.length;f>g;g++){if(i=C[g],o++,l.length<=o)for(y=0,x=l.length-o;x>=0?x>=y:y>=x;x>=0?y++:y--)l.push({rowspan:0});l[o].rowspan&&(l[o].rowspan--,o++),null!=i.attrs&&null!=i.attrs.rowspan&&1!==i.attrs.rowspan&&(l[o].rowspan+=i.attrs.rowspan-1),null==i.attrs||null==i.attrs.colspan||1===i.attrs.colspan?(null==l[o].width?(T="auto",b="initial",null!=i.attrs&&(null!=i.attrs.width&&(T=i.attrs.width),null!=i.attrs.minWidth&&(b=i.attrs.minWidth))):(T=l[o].width,b=l[o].minWidth),"fixed"===t&&T.toString().match(/^\d+(px)?$/)?(T=parseInt(T),O-=T,a++):"percent"===t&&T.toString().match(/^\d+%$/)?(T=parseInt(O*(parseFloat(T)/100)),a++):"auto"===t&&"auto"===T&&(T=parseInt(O*(1/(this.cols-a)))),l[o].width=T,l[o].minWidth=b):o+=i.attrs.colspan-1}for(this.table.css({paddingRight:O-parseInt(O*(1/(this.cols-a)))*(this.cols-a)}),e=v=0,p=l.length;p>v;e=++v)n=l[e],S.columnRule(e,{width:n.width+"px",minWidth:n.minWidth+(isNaN(parseInt(n.minWidth))?"":"px")});this.head.width()<this.head.find("table").width()&&this.table.width(this.head.find("table").width()),this.body.getNiceScroll().length||this.rowResize()},t.prototype.rowResize=function(){var t;null!=this.height?(this.table.css("maxHeight",this.height),t=this.table.height()-this.head.height()-this.foot.height()):this.body.height()&&(this.body.css("display","none"),t=parseInt(this.table.closest(this.heightOfParent).height())-(parseFloat(this.table.outerHeight())+(this.body.is(":empty")?1:0)-(null!=this.margin?this.margin:0))),this.body.css({maxHeight:t?t:"",display:"block"}),this.body.get(0).scrollHeight>t?this.body.getNiceScroll().length?this.body.getNiceScroll().resize():this.body.niceScroll({horizrailenabled:!1,cursoropacitymin:1,railalign:this.scrollAlign,enablekeyboard:!this.arrowNavigation,cursorwidth:3,railpadding:{top:1,right:1,left:1,bottom:1}}):this.body.getNiceScroll().remove()},t.prototype.renderColumns=function(t){var e,i,n,l,a,o;if(this.columns=t,l=null,o=[],this.cols=0,this.columns.length)for(o=Array.isArray(this.columns[0])?this.columns:[this.columns],a=o[0],i=0,n=a.length;n>i;i++)e=a[i],this.cols+=null!=e.attrs&&null!=e.attrs.colspan?e.attrs.colspan:1;return o.columns=this.cols,this.showDefaultOrder&&this.order&&(l={field:this.order.substr(!this.order.indexOf("-")),sort:this.order.indexOf("-")?"asc":"desc"}),this.head.html(this.templates.columns({rows:o,order:l})),this.columnsBinds(),this.head},t.prototype.renderFooter=function(t){var e,i,n,l,a;if(this.footer=t,a=[],this.footer.length)for(n=this.footer,e=0,i=n.length;i>e;e++)l=n[e],Array.isArray(l)?a.push({attrs:null,cells:l}):a.push(l);return a.columns=this.cols,this.foot.html(this.templates.foot({rows:a})),this.foot},t.prototype.uid=function(){return Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)},t.prototype.render=function(){var t,e;for(t=JSON.parse(JSON.stringify(this.attrs)),null==t.id&&(t.id="uid_"+this.uid());$("#uid_"+this.attrs.id).length;)t.id="uid_"+this.uid();return null!=t["class"]&&(this.table.addClass(t["class"]),delete t["class"]),this.table.attr(t).addClass("table-data scroll-"+this.scrollAlign+(this.selectable?" selectable":"")+(this.arrowNavigation?" arrow-navigation":"")),this.renderColumns(this.columns),this.renderRows(this.rows),this.renderFooter(this.footer),this.table.append(this.head),this.table.append(this.body),this.table.append(this.foot),e=this,$(window).on("resize.table",function(){e.table.is(":visible")&&(e.columnsResize(),e.rowResize())}),this.table},t}();var TableForm;TableForm=function(){function t(t){var e,i,n,l;this.edit=!1,this.form=$('<div class="form" />'),this.table=null,this.pinned=!1,this.formData=null,this.getData=null,this.request=null,this.fields=[],this.actions=[],this.template=swig.compile('<form{% for attr, value in form.attrs %} {{attr}}="{{value}}"{% endfor %}> {% if form.name %}<p class="name {{form.name.attrs.class}}">{{form.name.label}}</p>{% endif %} {% for field in fields %} {% if field.type == "hidden" %}<input type="hidden" name="{{field.name}}" value="{{field.value}}" />{% else %} <div class="field{% if field.fields.length > 1 %} multiple{% endif %}{% if field.attrs.class %} {{field.attrs.class}}{% endif %}">{% if field.group %}<p class="group{% if field.group.class %} {{field.group.class}}{% endif %}">{% if field.group.label %}{{field.group.label}}{% else %}{{field.group}}{% endif %}</p>{% endif %}{% for input in field.fields %}{% if input.label and (not input.label.position or input.label.position and input.label.position == "before") %} <label for="{{_prefix}}input_{{input.name}}"{% if input.label.class or input.required %} class="{% if input.required %}required{% endif %}{% if input.label.class %} {{input.label.class}}{% endif %}"{% endif %}>{% if input.label.text %}{{input.label.text}}{% else %}{{input.label}}{% endif %}</label>{% endif %}{% if input.type == "textarea" %} <textarea id="{{_prefix}}input_{{input.name}}" name="{{input.name}}" {% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %}{% if input.length %} data-length="{{input.length}}"{% endif %}>{{input.value}}</textarea>{% elif input.type == "date" %} <div class="date-picker" id="{{_prefix}}input_{{input.name}}"><input type="text" name="{{input.name}}" value="{{input.value}}" {% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %} /></div>{% elif input.type == "time" %} <div class="time-picker" id="{{_prefix}}input_{{input.name}}"><input type="text" name="{{input.name}}" value="{{input.value}}"/></div>{% elif input.type == "select" %} <select id="{{_prefix}}input_{{input.name}}" name="{{input.name}}" {% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %}>{% for value, label in input.options %}<option value="{{value}}"{% if value == input.value %} selected="selected"{% endif %}>{{label}}</option>{% endfor %}</select>{% elif input.type == "related" %} <input type="hidden" id="{{_prefix}}input_{{input.name}}" name="{{input.name}}" data-select="related" value="{{input.value}}" data-text="{{input.text}}" data-url="{{input.url}}" data-placeholder="{{input.placeholder}}" data-order="{{input.order}}" data-results=\'{{input.results}}\'{% if input.related %} data-related=\'{{input.related|json}}\'{% endif %}{% if input.children %} data-children=\'{{input.children|json}}\'{% endif %}{% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %}/>{% elif input.type == "checkbox" %} <input type="checkbox" id="{{_prefix}}input_{{input.name}}" name="{{input.name}}"{% if input.value %} checked="checked" {% endif %}{% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %} />{% elif input.type == "text" or input.type == "digits" %} <input type="text" id="{{_prefix}}input_{{input.name}}" name="{{input.name}}" value="{{input.value}}" data-type="{{input.type}}"{% if input.length %} data-length="{{input.length}}"{% endif %}{% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %} />{% else %} <input type="{{input.type}}" id="{{_prefix}}input_{{input.name}}" name="{{input.name}}" value="{{input.value}}"{% for attr, value in input.attrs %} {{attr}}="{{value}}"{% endfor %}{% if input.length %} data-length="{{input.length}}"{% endif %} />{% endif %}{% if input.label and (input.label.position and input.label.position == "after") %} <label for="{{_prefix}}input_{{input.name}}"{% if input.label.class or input.required %} class="{% if input.required %}required{% endif %}{% if input.label.class %} {{input.label.class}}{% endif %}"{% endif %}>{% if input.label.text %}{{input.label.text}}{% else %}{{input.label}}{% endif %}</label>{% endif %}{% endfor %} <span class="error-text"></span></div>{% endif %}{% endfor %}{% if actions.length %}{% for action in actions %} <button type="button" class="btn btn-{{action.id}}{% if action.class %} {{action.class}}{% endif %}"{% for attr, value in action.attrs %} {{attr}}="{{value}}"{% endfor %}>{{action.label}}</button>{% endfor %}{% else %} <button type="button" class="btn btn-success btn-ok">Ok</button> <button type="button" class="btn btn-danger btn-cancel">Cancel</button>{% endif %}</form>'),n=this.constructor["default"];for(i in n)l=n[i],this[i]=l;for(e in t)e in this&&(this[e]=t[e]);if(null!=this.formData.attrs&&this.formData.attrs.id)this.prefix=this.formData.attrs.id;else for(this.prefix="uid_"+this.uid();$("[id^='"+this.prefix+"']").length;)this.prefix="uid_"+this.uid()}return t.VERSION="2.2.6",t["default"]={contentType:!1,actionNotification:!0,datePickerOptions:{dateFormat:"dd/mm/yy"},timePickerOptions:{parse:"loose",timeFormat:"HH:mm:ss"},loadLength:50,after:null,onSubmit:null,onComplete:null,onCancel:null,onActionNotification:null,onDelete:null,sendCSRFTokenHeader:!0},t.prototype.getCsrfToken=function(){var t,e,i,n;for(n="csrftoken=",e=document.cookie.split(";"),i=0;i<e.length;){for(t=e[i];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return t.substring(n.length,t.length).replace(/"/g,"");i++}return e},t.prototype.uid=function(){return Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)},t.prototype.bindForm=function(){var t,e,i,n,l;for(l=this,this.form.find(":input").change(function(){l.form.closest("tr").addClass("edited")}),this.form.on("focus","input, textarea",function(){try{this.setSelectionRange(0,this.value.length)}catch(t){}}),this.form.on("keypress","input, textarea",function(t){var e,i;if(i=$(t.target),null!=i.data("length")&&i.val().length>=parseInt(i.data("length")))return!1;if(null!=i.data("type"))switch(i.data("type")){case"digits":if(e=null!=t.charCode?t.charCode:t.keyCode,e&&(e>57||48>e))return!1}}),this.form.on("keyup","input",function(t){var e;return 13===t.keyCode?(e=$(t.target).nextAll("input, textarea, select").not(".skip-focus").first(),e.length||(e=$(t.target).closest(".field").nextAll(".field").not(".skip-focus").first().find("input, textarea, select")),e.length||(e=l.form.find(".btn-ok")),e.first().focus()):void 0}),null!=$.fn.datepicker&&(this.form.find(".date-picker input").datepicker(this.datePickerOptions),this.form.find(".date-picker").click(function(){$(this).find("input").datepicker("show")})),null!=$.fn.timepicker&&(this.form.find(".time-picker input").timepicker(this.timePickerOptions),this.form.find(".time-picker").click(function(){$(this).find("input").timepicker("show")})),this.form.find("[data-select=related]").each(function(){return $(this).select2($.extend(!0,$(this).data("options")?$(this).data("options"):{},{initSelection:function(t,e){var i,n;n=t.data(),i={id:t.val(),text:n.text},e(i)},query:function(t){var e,i,n;n=t.element.data(),e={more:!1,results:[]},i=null!=n.related?"object"==typeof n.related?$.extend({},n.related):{related:n.related}:{},i.select=!0,i.ordering=n.order,i.text=t.term,i.start=(t.page-1)*l.loadLength,i.length=l.loadLength,i[n.results.term]=t.term,$.getJSON(n.url,i,function(i){var a,o,s;for(e.more=i.length===l.loadLength,o=0,s=i.length;s>o;o++)a=i[o],null!=n.format&&(a=n.format(a)),e.results.push({id:a[n.results.id].toString(),text:a[n.results.text].toString()});t.callback(e)})}})).change(function(t){var e,i,n,a,o,s,r,d,u,c,h,f;if(n=$(t.target),d=n.data(),null!=d.children)for(s=d.children,a=0,o=s.length;o>a;a++){e=s[a],c=l.form.find("[name="+e+"]"),u=c.data(),null!=d.results.reference&&null!=u.related&&"object"==typeof u.related?u.related[d.results.reference]=n.val():u.related=n.val(),null==u.relatedElements&&(u.relatedElements={}),u.relatedElements[n.attr("name")]=!!n.val(),c.data(u),null!=t.added&&c.select2("val","").trigger("change"),i=!1,r=u.relatedElements;for(h in r)f=r[h],f||(i=!0);c.prop("disabled",i)}}).trigger("change")}),this.form.find(".btn-cancel").click(function(){var t;(null==l.onCancel||(t=l.onCancel(l),null==t||t))&&null!=l.table&&l.table.closeRowContainer(l.form.closest("tr.row-content").index())}),this.form.find(".btn-ok").click(function(){l.sendData()}),n=this.actions,e=0,i=n.length;i>e;e++)t=n[e],null!=t.callback&&!function(t){l.form.find(".btn-"+t.id).click(function(){t.callback(l)})}(t);this.form.on("submit",function(){return l.sendData(),!1})},t.prototype.render=function(){var t,e,i,n,l,a,o,s,r,d,u;if(i=this,this.edit&&!this.form.html()&&null==this.request)this.form.html($("<em />").text("Loading form data")),this.formData.attrs.action=""+this.formData.attrs.action+this.edit+"/",this.loadData();else{for(e=[],r=this.fields,l=0,o=r.length;o>l;l++)for(t=r[l],null!=t.type&&"hidden"===t.type&&e.push(t),t instanceof Array?e.push({fields:t}):null==t.fields?e.push({fields:[t]}):e.push(t),d=e[e.length-1].fields,a=0,s=d.length;s>a;a++)n=d[a],"related"===n.type&&null!=n.children&&"string"==typeof n.children&&(n.children=[n.children]),
null!=n.value&&("date"===n.type&&null!=$.fn.datepicker&&"Invalid Date"!==new Date(n.value).toString()&&(n.value=$.datepicker.formatDate(this.datePickerOptions.dateFormat,new Date(n.value))),"time"===n.type&&null!=$.fn.timepicker&&(u=new Date(n.value),"Invalid Date"===u.toString()&&n.value.match(/(\d{2})(\.\d{3})?/g)&&(u=new Date((new Date).toISOString().substr(0,11)+n.value.match(/(\d{2})(\.\d{3})?/g).join(":")+"Z")),"Invalid Date"!==u.toString()&&(n.value=$.datepicker.formatTime(this.timePickerOptions.timeFormat,{hour:u.getUTCHours(),minute:u.getUTCMinutes(),second:u.getUTCSeconds()}))));this.form.html($(this.template({form:this.formData,fields:e,actions:this.actions,_prefix:this.prefix+"_"}))),this.bindForm(),null!=this.table&&this.form.closest(".row-content").length&&this.table.scrollRowContainer(this.form.closest(".row-content")),setTimeout(function(){i.form.find(".auto-focus").length?i.form.find(".auto-focus").focus():i.form.find(":input:visible:not([disabled]):first").focus(),null!=i.after&&i.after(i)},0)}return this.form},t.prototype.delData=function(){var t,e,i;if(i=this,e=function(){var t;t=[],i.formData.attrs.action=""+i.formData.attrs.action+i.edit+"/",i.request=$.ajax({url:i.formData.attrs.action,data:JSON.stringify(t),type:null!=i.formData.attrs.method?i.formData.attrs.method:"DELETE",contentType:null!=i.formData.contentType?i.formData.contentType:i.contentType,dataType:"json",headers:i.sendCSRFTokenHeader?{"X-CSRFToken":i.getCsrfToken()}:{},complete:function(t){var e;return i.request=null,i.actionNotification&&null!=i.onActionNotification&&(e=i.onActionNotification(t,i),null!=e&&!e)?!1:void(204===t.status?(i.actionNotification&&null==i.onActionNotification&&alert("Deleted!"),i.table.resetTable()):console.error("unknown status"))}})},this.edit&&null==this.request){if(null!=this.onDelete){if(t=this.onDelete(i,e),null!=t&&!t)return}else if(!confirm("You are sure?"))return;e()}},t.prototype.loadData=function(){var t;t=this,null==this.request&&(this.request=$.getJSON(this.formData.attrs.action,{},function(e){var i,n,l,a,o,s,r,d;for(null!=t.getData&&(e=t.getData(e)),r=t.fields,l=0,o=r.length;o>l;l++)if(i=r[l],null!=i.fields||i instanceof Array)for(d=null!=i.fields?i.fields:i,a=0,s=d.length;s>a;a++)n=d[a],null!=e[n.name]&&t.fieldValue(n,e);else null!=e[i.name]&&t.fieldValue(i,e);t.request=null,t.render()}))},t.prototype.fieldValue=function(t,e){var i;null!=t.name&&null!=e[t.name]&&("related"===t.type&&null!=e[t.text]?t.text=e[t.text]:"date"===t.type&&"Invalid Date"!==new Date(e[t.name]).toString()?e[t.name]=new Date(e[t.name]):"time"===t.type&&e[t.name].length>=4&&(i=e[t.name].match(/(\d{2})(\.\d{3})?/g),e[t.name]=new Date((new Date).toISOString().substr(0,11)+i.join(":")+"Z")),t.value=e[t.name])},t.prototype.sendData=function(){var t,e,i,n,l,a,o,s,r,d;if((null==this.onSubmit||(t=this.onSubmit(this),null==t||t))&&null==this.request){for(i={},d=this,r=this.form.find("[name]"),o=0,s=r.length;s>o;o++)l=r[o],$(l).parent().is(".date-picker")?(a=$(l).attr("name"),$(l).datepicker("getDate")?(n=$(l).datepicker("getDate"),n.setMinutes(-n.getTimezoneOffset()),i[a]=n.toISOString().match(/^[^T]+/g)[0]):i[a]=""):$(l).parent().is(".time-picker")?(a=$(l).attr("name"),$(l).timepicker("getDate")?i[a]=$(l).val().match(/(\d{2}:\d{2}(:\d{2})?)/g):i[a]=""):"checkbox"===$(l).attr("type")?$(l).is(":checked")&&(i[$(l).attr("name")]=$(l).val()?$(l).val():"on"):i[$(l).attr("name")]=$(l).val();e=null!=this.formData.contentType?this.formData.contentType:this.contentType,this.request=$.ajax({url:this.formData.attrs.action,data:"application/json"===e?JSON.stringify(i):i,type:null!=this.formData.attrs.method?this.formData.attrs.method:this.edit?"PUT":"POST",contentType:e,dataType:"json",headers:this.sendCSRFTokenHeader?{"X-CSRFToken":this.getCsrfToken()}:{},complete:function(e){var i,n,a,o,s,r,u;if(d.request=null,null==d.onComplete||(i=d.onComplete(d,e),null==i||i)){if(d.form.find(".field").removeClass("error").find(".error-text").text(""),200===(s=e.status)||201===s){if(d.actionNotification)if(null!=d.onActionNotification){if(t=d.onActionNotification(e,d),null!=t&&!t)return!1}else alert(200===e.status?"Updated!":"Added!");d.table.closeRowContainer(d.form.closest("tr").index(),!0),d.table.resetTable()}else if(400===e.status){"__all__"in e.responseJSON&&(l=d.form.find("[name]"),l.length&&(n=$(l).parent(),n.addClass("error"),n.find(".error-text").text(e.responseJSON.__all__.join(", ")))),r=d.form.find("[name]");for(a=0,o=r.length;o>a;a++)l=r[a],l=$(l),n=l.parent(),n.is(".date-picker")&&(n=n.parent()),l.attr("name")in e.responseJSON&&(n.addClass("error"),u=n.hasClass("multiple")&&n.find(".error-text").text()?n.find(".error-text").text()+", ":"",n.find(".error-text").text(u+e.responseJSON[l.attr("name")].join(", ")))}else console.error("unknown status");null!=d.table&&d.table.body.trigger("scroll")}}})}},t}();
//# sourceMappingURL=TableTableForm.min.js.map
